{"uid":"6e03f288f22d33e","name":"test_refresh_token_success[authorize_client]","fullName":"tests.auth.test_04_refresh#test_refresh_token_success","historyId":"fd2d99740ef886fd3778d2e88800f074","time":{"start":1744364079672,"stop":1744364080633,"duration":961},"description":"Тест успешного обновления токена через refresh-токен.","descriptionHtml":"<p>Тест успешного обновления токена через refresh-токен.</p>\n","status":"skipped","statusMessage":"XFAIL https://ru.yougile.com/team/01c2a92f1328/#IT-468\n\nKeyError: 'status_code'","statusTrace":"api_client = <api_tests.utils.api_client.APIClient object at 0x7fca00297cd0>\nauthorize_func = <function authorize_client at 0x7fca0036e340>\n\n    @pytest.mark.smoke\n    @pytest.mark.xfail(reason=\"https://ru.yougile.com/team/01c2a92f1328/#IT-432\")\n    @pytest.mark.xfail(reason=\"https://ru.yougile.com/team/01c2a92f1328/#IT-468\")\n    @pytest.mark.parametrize(\"authorize_func\", [authorize_client, authorize_partner, authorize_admin])\n    def test_refresh_token_success(api_client, authorize_func):\n        \"\"\"Тест успешного обновления токена через refresh-токен.\"\"\"\n    \n        auth_response = authorize_func(api_client)\n        access_token = auth_response[\"access_token\"][\"token\"]\n        refresh_token = auth_response[\"refresh_token\"][\"token\"]\n    \n        # Передаем refresh-токен в заголовке Authorization\n        headers = {\"Authorization\": f\"Bearer {refresh_token}\"}\n        response = api_client.post(\"/auth/refresh\", headers=headers)\n    \n        assert_response_status_OK(api_client.last_response.status_code, 200)\n        assert_login_fields(response)\n    \n        # Проверяем, что новый access-токен отличается от старого\n        new_access_token = response[\"access_token\"][\"token\"]\n        assert new_access_token != access_token, \"Новый access_token должен отличаться от старого\"\n    \n        # Проверяем, что старый токен больше не работает\n        api_client.set_auth_token(access_token)\n        payload = {\n            \"request_type\": \"OtherQuestions\",\n            \"title\": \"Тестовый тикет\",\n            \"message\": {\"message\": \"Текст сообщения\"}\n        }\n        restricted_response = api_client.post(\"/tickets/create\", json=payload)\n>       assert_response_status_and_error(response, 401)\n\napi_tests/tests/auth/test_04_refresh.py:38: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nresponse = {'access_token': {'expires_at': 1744365880357, 'token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NDQzNjU4ODAs...WJsZV9pZCI6MTc5Nn0sInVzZXJSb2xlcyI6bnVsbH0.NywcXXJoioonklpcEZ41jPvZ1JnOc6WoWTFTqUOzqAQ'}, 'server_time': 1744364080364}\nexpected_status = 401\n\n    def assert_response_status_and_error(response, expected_status):\n>       actual_status = response[\"status_code\"]\nE       KeyError: 'status_code'\n\napi_tests/utils/asserts.py:38: KeyError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"api_client","time":{"start":1744364079671,"stop":1744364079671,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"api_client::0","time":{"start":1744364082195,"stop":1744364082195,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"@pytest.mark.xfail(reason='https://ru.yougile.com/team/01c2a92f1328/#IT-468')"},{"name":"tag","value":"smoke"},{"name":"parentSuite","value":"tests.auth"},{"name":"suite","value":"test_04_refresh"},{"name":"host","value":"fv-az1942-357"},{"name":"thread","value":"1853-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.auth.test_04_refresh"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"authorize_func","value":"<function authorize_client at 0x7fca0036e340>"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":["smoke","@pytest.mark.xfail(reason='https://ru.yougile.com/team/01c2a92f1328/#IT-468')"]},"source":"6e03f288f22d33e.json","parameterValues":["<function authorize_client at 0x7fca0036e340>"]}