{"uid":"446de75af9341584","name":"test_refresh_token_success[authorize_partner]","fullName":"tests.auth.test_04_refresh#test_refresh_token_success","historyId":"9ad7a144fd3052ebea279abdbba7fba9","time":{"start":1744675933348,"stop":1744675933956,"duration":608},"description":"Тест успешного обновления токена через refresh-токен.","descriptionHtml":"<p>Тест успешного обновления токена через refresh-токен.</p>\n","status":"skipped","statusMessage":"XFAIL https://ru.yougile.com/team/01c2a92f1328/#IT-468\n\nKeyError: 'status_code'","statusTrace":"api_client = <api_tests.utils.api_client.APIClient object at 0x7f5550161d50>\nauthorize_func = <function authorize_partner at 0x7f555023a480>\n\n    @pytest.mark.smoke\n    @pytest.mark.xfail(reason=\"https://ru.yougile.com/team/01c2a92f1328/#IT-432\")\n    @pytest.mark.xfail(reason=\"https://ru.yougile.com/team/01c2a92f1328/#IT-468\")\n    @pytest.mark.parametrize(\"authorize_func\", [authorize_client, authorize_partner, authorize_admin])\n    def test_refresh_token_success(api_client, authorize_func):\n        \"\"\"Тест успешного обновления токена через refresh-токен.\"\"\"\n    \n        auth_response = authorize_func(api_client)\n        access_token = auth_response[\"access_token\"][\"token\"]\n        refresh_token = auth_response[\"refresh_token\"][\"token\"]\n    \n        # Передаем refresh-токен в заголовке Authorization\n        headers = {\"Authorization\": f\"Bearer {refresh_token}\"}\n        response = api_client.post(\"/auth/refresh\", headers=headers)\n    \n        assert_response_status_OK(api_client.last_response.status_code, 200)\n        assert_login_fields(response)\n    \n        # Проверяем, что новый access-токен отличается от старого\n        new_access_token = response[\"access_token\"][\"token\"]\n        assert new_access_token != access_token, \"Новый access_token должен отличаться от старого\"\n    \n        # Проверяем, что старый токен больше не работает\n        api_client.set_auth_token(access_token)\n        payload = {\n            \"request_type\": \"OtherQuestions\",\n            \"title\": \"Тестовый тикет\",\n            \"message\": {\"message\": \"Текст сообщения\"}\n        }\n        restricted_response = api_client.post(\"/tickets/create\", json=payload)\n>       assert_response_status_and_error(response, 401)\n\napi_tests/tests/auth/test_04_refresh.py:38: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nresponse = {'access_token': {'expires_at': 1744677733728, 'token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NDQ2Nzc3MzMs...Zpc2libGVfaWQiOjJ9LCJ1c2VyUm9sZXMiOm51bGx9.MqzqyH7EpS8joiR-dgaiWPJSx8fiejYvD7cKzy5dscE'}, 'server_time': 1744675933735}\nexpected_status = 401\n\n    def assert_response_status_and_error(response, expected_status):\n>       actual_status = response[\"status_code\"]\nE       KeyError: 'status_code'\n\napi_tests/utils/asserts.py:38: KeyError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"api_client","time":{"start":1744675932422,"stop":1744675932422,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"api_client::0","time":{"start":1744675934891,"stop":1744675934891,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"@pytest.mark.xfail(reason='https://ru.yougile.com/team/01c2a92f1328/#IT-468')"},{"name":"tag","value":"smoke"},{"name":"parentSuite","value":"tests.auth"},{"name":"suite","value":"test_04_refresh"},{"name":"host","value":"fv-az815-398"},{"name":"thread","value":"1829-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.auth.test_04_refresh"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"authorize_func","value":"<function authorize_partner at 0x7f555023a480>"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":["smoke","@pytest.mark.xfail(reason='https://ru.yougile.com/team/01c2a92f1328/#IT-468')"]},"source":"446de75af9341584.json","parameterValues":["<function authorize_partner at 0x7f555023a480>"]}